<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Alexander Sowarka" />

<meta name="date" content="2020-11-30" />

<title>Journal (reproducible report)</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="site_libs/anchor-sections-1.0/anchor-sections.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">MyLabJournal</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="journal.html">Journal</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Class notes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="dictionary.html">Dictionary</a>
    </li>
    <li>
      <a href="data_wrangling.html">Data Wrangling</a>
    </li>
    <li>
      <a href="ggplot_graphs.html">ggplot graphs</a>
    </li>
    <li>
      <a href="machine_learning.html">machine learning</a>
    </li>
  </ul>
</li>
<li>
  <a href="links.html">Links</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">

<div class="btn-group pull-right">
<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Journal (reproducible report)</h1>
<h4 class="author">Alexander Sowarka</h4>
<h4 class="date">2020-11-30</h4>

</div>


<div id="intro-to-tidyverse-challenge" class="section level1">
<h1><span class="header-section-number">1</span> Intro to tidyverse Challenge</h1>
<p>Last compiled: 2020-12-04</p>
<div id="given-code" class="section level2">
<h2><span class="header-section-number">1.1</span> Given Code</h2>
<p>Following given code chunks from the exercise are used:</p>
<pre class="r"><code># Data Science at TUHH ------------------------------------------------------
# SALES ANALYSIS ----

# 1.0 Load libraries ----
library(tidyverse)
library(readxl)
library(lubridate)

# 2.0 Importing Files ----
# A good convention is to use the file name and suffix it with tbl for the data structure tibble
bikes_tbl      &lt;- read_excel(path = &quot;00_data/01_bike_sales/01_raw_data/bikes.xlsx&quot;)
orderlines_tbl &lt;- read_excel(&quot;00_data/01_bike_sales/01_raw_data/orderlines.xlsx&quot;)

# Not necessary for this analysis, but for the sake of completeness
bikeshops_tbl  &lt;- read_excel(&quot;00_data/01_bike_sales/01_raw_data/bikeshops.xlsx&quot;)

# 3.0 Examining Data ----


# 4.0 Joining Data ----
bike_orderlines_joined_tbl &lt;- orderlines_tbl %&gt;%
  left_join(bikes_tbl, by = c(&quot;product.id&quot; = &quot;bike.id&quot;)) %&gt;%
  left_join(bikeshops_tbl, by = c(&quot;customer.id&quot; = &quot;bikeshop.id&quot;))

# Examine the results with glimpse()
bike_orderlines_joined_tbl %&gt;% glimpse()</code></pre>
<pre><code>## Rows: 15,644
## Columns: 19
## $ ...1           &lt;chr&gt; &quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot;, &quot;5&quot;, &quot;6&quot;, &quot;7&quot;, &quot;8&quot;, &quot;9&quot;, &quot;10&quot;, &quot;...
## $ order.id       &lt;dbl&gt; 1, 1, 2, 2, 3, 3, 3, 3, 3, 4, 5, 5, 5, 5, 6, 6, 6, 6...
## $ order.line     &lt;dbl&gt; 1, 2, 1, 2, 1, 2, 3, 4, 5, 1, 1, 2, 3, 4, 1, 2, 3, 4...
## $ order.date     &lt;dttm&gt; 2015-01-07, 2015-01-07, 2015-01-10, 2015-01-10, 201...
## $ customer.id    &lt;dbl&gt; 2, 2, 10, 10, 6, 6, 6, 6, 6, 22, 8, 8, 8, 8, 16, 16,...
## $ product.id     &lt;dbl&gt; 2681, 2411, 2629, 2137, 2367, 1973, 2422, 2655, 2247...
## $ quantity       &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 1, 1, 1, 1, 1, 1...
## $ model          &lt;chr&gt; &quot;Spectral CF 7 WMN&quot;, &quot;Ultimate CF SLX Disc 8.0 ETAP&quot;...
## $ model.year     &lt;dbl&gt; 2021, 2020, 2021, 2019, 2020, 2020, 2020, 2021, 2020...
## $ frame.material &lt;chr&gt; &quot;carbon&quot;, &quot;carbon&quot;, &quot;carbon&quot;, &quot;carbon&quot;, &quot;aluminium&quot;,...
## $ weight         &lt;dbl&gt; 13.80, 7.44, 14.06, 8.80, 11.50, 8.80, 8.20, 8.85, 1...
## $ price          &lt;dbl&gt; 3119, 5359, 2729, 1749, 1219, 1359, 2529, 1559, 3899...
## $ category       &lt;chr&gt; &quot;Mountain - Trail - Spectral&quot;, &quot;Road - Race - Ultima...
## $ gender         &lt;chr&gt; &quot;female&quot;, &quot;unisex&quot;, &quot;unisex&quot;, &quot;unisex&quot;, &quot;unisex&quot;, &quot;u...
## $ url            &lt;chr&gt; &quot;https://www.canyon.com/en-de/mountain-bikes/trail-b...
## $ name           &lt;chr&gt; &quot;AlexandeRad&quot;, &quot;AlexandeRad&quot;, &quot;WITT-RAD&quot;, &quot;WITT-RAD&quot;...
## $ location       &lt;chr&gt; &quot;Hamburg, Hamburg&quot;, &quot;Hamburg, Hamburg&quot;, &quot;Bremen, Bre...
## $ lat            &lt;dbl&gt; 53.57532, 53.57532, 53.07379, 53.07379, 48.78234, 48...
## $ lng            &lt;dbl&gt; 10.015340, 10.015340, 8.826754, 8.826754, 9.180819, ...</code></pre>
<pre class="r"><code># 5.0 Wrangling Data ----
# All actions are chained with the pipe already. You can perform each step separately and use glimpse() or View() to validate your code. Store the result in a variable at the end of the steps.
bike_orderlines_wrangled_tbl &lt;- bike_orderlines_joined_tbl %&gt;%
  # 5.1 Separate category name
separate(col    = category,
         into   = c(&quot;category.1&quot;, &quot;category.2&quot;, &quot;category.3&quot;),
         sep    = &quot; - &quot;) %&gt;%

# 5.2 Add the total price (price * quantity) 
# Add a column to a tibble that uses a formula-style calculation of other columns
mutate(total.price = price * quantity) %&gt;%

# 5.3 Optional: Reorganize. Using select to grab or remove unnecessary columns
# 5.3.1 by exact column name
select(-...1, -gender) %&gt;%

# 5.3.2 by a pattern
# You can use the select_helpers to define patterns. 
# Type ?ends_with and click on Select helpers in the documentation
select(-ends_with(&quot;.id&quot;)) %&gt;%

# 5.3.3 Actually we need the column &quot;order.id&quot;. Let&#39;s bind it back to the data
bind_cols(bike_orderlines_joined_tbl %&gt;% select(order.id)) %&gt;% 

# 5.3.4 You can reorder the data by selecting the columns in your desired order.
# You can use select_helpers like contains() or everything()
select(order.id, contains(&quot;order&quot;), contains(&quot;model&quot;), contains(&quot;category&quot;),
       price, quantity, total.price,
       everything()) %&gt;%

# 5.4 Rename columns because we actually wanted underscores instead of the dots
# (one at the time vs. multiple at once)
rename(bikeshop = name) %&gt;%
set_names(names(.) %&gt;% str_replace_all(&quot;\\.&quot;, &quot;_&quot;))</code></pre>
</div>
<div id="data-wrangling" class="section level2">
<h2><span class="header-section-number">1.2</span> Data Wrangling</h2>
<p>For the challenge first the data wrangling needs to be adapted to separate the location attribute into city and state:</p>
<pre class="r"><code>bike_orderlines_wrangled_tbl &lt;- bike_orderlines_wrangled_tbl %&gt;%
# 5.5 Separate Location into State and City
separate(col    = location,
         into   = c(&quot;city&quot;, &quot;state&quot;),
         sep    = &quot;, &quot; )
bike_orderlines_wrangled_tbl</code></pre>
<pre><code>## # A tibble: 15,644 x 19
##    order_id order_line order_date          model model_year category_1
##       &lt;dbl&gt;      &lt;dbl&gt; &lt;dttm&gt;              &lt;chr&gt;      &lt;dbl&gt; &lt;chr&gt;     
##  1        1          1 2015-01-07 00:00:00 Spec~       2021 Mountain  
##  2        1          2 2015-01-07 00:00:00 Ulti~       2020 Road      
##  3        2          1 2015-01-10 00:00:00 Neur~       2021 Mountain  
##  4        2          2 2015-01-10 00:00:00 Spee~       2019 Road      
##  5        3          1 2015-01-10 00:00:00 Stit~       2020 Mountain  
##  6        3          2 2015-01-10 00:00:00 Road~       2020 Hybrid / ~
##  7        3          3 2015-01-10 00:00:00 Spee~       2020 Road      
##  8        3          4 2015-01-10 00:00:00 Infl~       2021 Road      
##  9        3          5 2015-01-10 00:00:00 Torq~       2020 Mountain  
## 10        4          1 2015-01-11 00:00:00 Ulti~       2020 Road      
## # ... with 15,634 more rows, and 13 more variables: category_2 &lt;chr&gt;,
## #   category_3 &lt;chr&gt;, price &lt;dbl&gt;, quantity &lt;dbl&gt;, total_price &lt;dbl&gt;,
## #   frame_material &lt;chr&gt;, weight &lt;dbl&gt;, url &lt;chr&gt;, bikeshop &lt;chr&gt;, city &lt;chr&gt;,
## #   state &lt;chr&gt;, lat &lt;dbl&gt;, lng &lt;dbl&gt;</code></pre>
</div>
<div id="buiseness-insights---sales-by-state" class="section level2">
<h2><span class="header-section-number">1.3</span> Buiseness Insights - Sales by State</h2>
<div id="data-manipulation" class="section level3">
<h3><span class="header-section-number">1.3.1</span> Data Manipulation</h3>
<p>The data must be grouped by the new created state column and then the sales must be summarised. This results in the sales per state.</p>
<pre class="r"><code>sales_by_loc_tbl &lt;- bike_orderlines_wrangled_tbl %&gt;%
  
# Select state and price
select(state, total_price) %&gt;%

# Group by State
group_by(state) %&gt;%
summarise(sales = sum(total_price)) %&gt;%
ungroup() %&gt;%

# Format $ Text
mutate(sales_text = scales::dollar(sales, big.mark = &quot;.&quot;, 
                                   decimal.mark = &quot;,&quot;, 
                                   prefix = &quot;&quot;, 
                                   suffix = &quot; €&quot;))

sales_by_loc_tbl</code></pre>
<pre><code>## # A tibble: 12 x 3
##    state                            sales sales_text  
##    &lt;chr&gt;                            &lt;dbl&gt; &lt;chr&gt;       
##  1 Baden-Württemberg              6521090 6.521.090 € 
##  2 Bavaria                        6742819 6.742.819 € 
##  3 Berlin                         1128433 1.128.433 € 
##  4 Bremen                        10653499 10.653.499 €
##  5 Hamburg                        3874756 3.874.756 € 
##  6 Hesse                          1558901 1.558.901 € 
##  7 Lower Saxony                   4107115 4.107.115 € 
##  8 Mecklenburg-Western Pomerania   618974 618.974 €   
##  9 North Rhine-Westphalia        21200613 21.200.613 €
## 10 Saxony                         2230245 2.230.245 € 
## 11 Saxony-Anhalt                   569614 569.614 €   
## 12 Schleswig-Holstein             3224749 3.224.749 €</code></pre>
</div>
<div id="data-visualization" class="section level3">
<h3><span class="header-section-number">1.3.2</span> Data Visualization</h3>
<p>For plotting the following code can be used:</p>
<pre class="r"><code>sales_by_loc_tbl %&gt;%
  
# Setup canvas with the columns year (x-axis) and sales (y-axis)
ggplot(aes(x = state, y = sales)) +

# Geometries
geom_col(fill = &quot;#2DC6D6&quot;) + # Use geom_col for a bar plot

  # Theme
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +

# Formatting
scale_y_continuous(labels = scales::dollar_format(big.mark = &quot;.&quot;, 
                                                  decimal.mark = &quot;,&quot;, 
                                                  prefix = &quot;&quot;, 
                                                  suffix = &quot; €&quot;)) +
labs(
  title = &quot;Revenue by State&quot;,
  x = &quot;State&quot;, # Override defaults for x and y
  y = &quot;Revenue&quot;
)</code></pre>
<p><img src="journal_files/figure-html/unnamed-chunk-4-1.png" width="960" /></p>
</div>
</div>
<div id="buiseness-insights---sales-by-state-and-year" class="section level2">
<h2><span class="header-section-number">1.4</span> Buiseness Insights - Sales by State and Year</h2>
<div id="data-manipulation-1" class="section level3">
<h3><span class="header-section-number">1.4.1</span> Data Manipulation</h3>
<p>The data must be grouped by the new created state column and newly created year column and then the sales must be summarised. This results in the sales per state and year.</p>
<pre class="r"><code>sales_by_loc_year_tbl &lt;- bike_orderlines_wrangled_tbl %&gt;%
  
# Select state and price and add a year
select(order_date, state, total_price) %&gt;%
mutate(year = year(order_date)) %&gt;%

# Group by State
group_by(year, state) %&gt;%
summarise(sales = sum(total_price)) %&gt;%
ungroup() %&gt;%

# Format $ Text
mutate(sales_text = scales::dollar(sales, big.mark = &quot;.&quot;, 
                                   decimal.mark = &quot;,&quot;, 
                                   prefix = &quot;&quot;, 
                                   suffix = &quot; €&quot;))

sales_by_loc_year_tbl  </code></pre>
<pre><code>## # A tibble: 60 x 4
##     year state                           sales sales_text 
##    &lt;dbl&gt; &lt;chr&gt;                           &lt;dbl&gt; &lt;chr&gt;      
##  1  2015 Baden-Württemberg             1031924 1.031.924 €
##  2  2015 Bavaria                       1301461 1.301.461 €
##  3  2015 Berlin                          95853 95.853 €   
##  4  2015 Bremen                        1395912 1.395.912 €
##  5  2015 Hamburg                        423090 423.090 €  
##  6  2015 Hesse                          308609 308.609 €  
##  7  2015 Lower Saxony                   584386 584.386 €  
##  8  2015 Mecklenburg-Western Pomerania  222003 222.003 €  
##  9  2015 North Rhine-Westphalia        3735092 3.735.092 €
## 10  2015 Saxony                         238371 238.371 €  
## # ... with 50 more rows</code></pre>
</div>
<div id="data-visualization-1" class="section level3">
<h3><span class="header-section-number">1.4.2</span> Data Visualization</h3>
<p>For plotting the following code can be used:</p>
<pre class="r"><code>sales_by_loc_year_tbl %&gt;%
  
  # Setup canvas with the columns year (x-axis) and sales (y-axis)
  ggplot(aes(x = year, y = sales, fill = state)) +
  
  # Geometries
  geom_col() + # Use geom_col for a bar plot
  
  # Facet
  facet_wrap(~ state) +
  
  # Theme
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  
  # Formatting
  scale_y_continuous(labels = scales::dollar_format(big.mark = &quot;.&quot;, 
                                                    decimal.mark = &quot;,&quot;, 
                                                    prefix = &quot;&quot;, 
                                                    suffix = &quot; €&quot;)) +
  labs(
    title = &quot;Revenue by State&quot;,
    x = &quot;&quot;, # Override defaults for x and y
    y = &quot;Revenue&quot;,
    fill = &quot;State&quot;
  )</code></pre>
<p><img src="journal_files/figure-html/unnamed-chunk-6-1.png" width="960" /></p>
</div>
</div>
</div>
<div id="data-acquisition-challenge" class="section level1">
<h1><span class="header-section-number">2</span> Data Acquisition Challenge</h1>
<div id="api-challeng" class="section level2">
<h2><span class="header-section-number">2.1</span> API Challeng</h2>
</div>
<div id="used-libs" class="section level2">
<h2><span class="header-section-number">2.2</span> Used Libs</h2>
<pre class="r"><code>#include packages
library(httr)
library(glue)
library(tidyverse)
library(jsonlite)
library(rvest)     # HTML Hacking &amp; Web Scraping
library(xopen)     # Quickly opening URLs
library(stringi)   # character string/text processing
# 1.1 COLLECT PRODUCT FAMILIES ----</code></pre>
</div>
<div id="chuck-norris-api" class="section level2">
<h2><span class="header-section-number">2.3</span> Chuck Norris API</h2>
<p>In the following jokes from the Chuck Norris Web API are requested (<a href="https://api.chucknorris.io/" class="uri">https://api.chucknorris.io/</a>). First the call to the API is wrapped in a function and the response is checked for its format. It is a normal JSON object.</p>
<pre class="r"><code># Wrapped Chuck Norris API into a function
chuck_api &lt;- function(path) {
  url &lt;- modify_url(url = &quot;https://api.chucknorris.io&quot;, path = glue(&quot;/jokes{path}&quot;))
  resp &lt;- GET(url)
  stop_for_status(resp) # automatically throws an error if a request did not succeed
  return (resp)
}
  #check response code
  resp &lt;- chuck_api(&quot;/random&quot;)
  resp</code></pre>
<pre><code>## Response [https://api.chucknorris.io/jokes/random]
##   Date: 2020-12-02 20:33
##   Status: 200
##   Content-Type: application/json;charset=UTF-8
##   Size: 343 B</code></pre>
<pre class="r"><code>  #check content
  resp %&gt;% 
    .$content %&gt;% 
    rawToChar()</code></pre>
<pre><code>## [1] &quot;{\&quot;categories\&quot;:[],\&quot;created_at\&quot;:\&quot;2020-01-05 13:42:22.980058\&quot;,\&quot;icon_url\&quot;:\&quot;https://assets.chucknorris.host/img/avatar/chuck-norris.png\&quot;,\&quot;id\&quot;:\&quot;0b2JLUQJRJq6wGprnTnKRw\&quot;,\&quot;updated_at\&quot;:\&quot;2020-01-05 13:42:22.980058\&quot;,\&quot;url\&quot;:\&quot;https://api.chucknorris.io/jokes/0b2JLUQJRJq6wGprnTnKRw\&quot;,\&quot;value\&quot;:\&quot;Chuck Norris sneezed twice--Hiroshima and Nagasaki were no more.\&quot;}&quot;</code></pre>
<p>Using this API one can define a function to directly get a random joke from a requested JSON Object.</p>
<pre class="r"><code># function to get random joke from API
get_joke &lt;- function() {
  joke_json &lt;- chuck_api(&quot;/random&quot;) %&gt;% 
  .$content %&gt;% 
  rawToChar() %&gt;% 
  fromJSON()
  return (joke_json$value)
}

get_joke()</code></pre>
<pre><code>## [1] &quot;Chuck Norris doesn&#39;t believe in ravioli. He stuffs a live turtle with beef and smothers it in pig&#39;s blood.&quot;</code></pre>
<p>The site offers also different categories for jokes.</p>
<pre class="r"><code>content(chuck_api(&quot;/categories&quot;), as = &quot;parsed&quot;)</code></pre>
<pre><code>## [[1]]
## [1] &quot;animal&quot;
## 
## [[2]]
## [1] &quot;career&quot;
## 
## [[3]]
## [1] &quot;celebrity&quot;
## 
## [[4]]
## [1] &quot;dev&quot;
## 
## [[5]]
## [1] &quot;explicit&quot;
## 
## [[6]]
## [1] &quot;fashion&quot;
## 
## [[7]]
## [1] &quot;food&quot;
## 
## [[8]]
## [1] &quot;history&quot;
## 
## [[9]]
## [1] &quot;money&quot;
## 
## [[10]]
## [1] &quot;movie&quot;
## 
## [[11]]
## [1] &quot;music&quot;
## 
## [[12]]
## [1] &quot;political&quot;
## 
## [[13]]
## [1] &quot;religion&quot;
## 
## [[14]]
## [1] &quot;science&quot;
## 
## [[15]]
## [1] &quot;sport&quot;
## 
## [[16]]
## [1] &quot;travel&quot;</code></pre>
<p>With the following query you can directly get a joke from the “dev” category.</p>
<pre class="r"><code>category=&quot;dev&quot;
content(chuck_api(glue(&quot;/random?category={category}&quot;)), as = &quot;parsed&quot;)%&gt;% 
  .$value</code></pre>
<pre><code>## [1] &quot;All browsers support the hex definitions #chuck and #norris for the colors black and blue.&quot;</code></pre>
</div>
<div id="web-scraping-of-radon" class="section level2">
<h2><span class="header-section-number">2.4</span> Web Scraping of Radon</h2>
<p>In the following data about the bicycles from Radon is retrieved from their website. First we retrieve all main categories from their site (<a href="https://www.radon-bikes.de/en/" class="uri">https://www.radon-bikes.de/en/</a>). Instead of using the banner at the top, we use the buttons further down to identify the categories:</p>
<pre class="r"><code>url_home          &lt;- &quot;https://www.radon-bikes.de/en/&quot;

# Read in the HTML for the entire webpage
html_home         &lt;- read_html(url_home)

# Web scrape the ids for the families
radon_family_tbl &lt;- html_home %&gt;%
  
  # Get the nodes for the families ...
  html_nodes(css = &quot;.a-panel--light&quot;) %&gt;%
  html_nodes(css = &quot;.a-button--margin-top-small&quot;) %&gt;%
  html_attr(&#39;href&#39;) %&gt;%
  
  # Convert vector to tibble
  enframe(name = &quot;position&quot;, value = &quot;subdirectory&quot;) %&gt;%
  
  #filter other urls
  filter(!(subdirectory %&gt;% str_detect(&quot;www.&quot;))) %&gt;%

  # Add the domain, because we will get only the subdirectories
   mutate(
    url = glue(&quot;https://www.radon-bikes.de{subdirectory}&quot;)
  ) %&gt;%

  # Some categories are listed multiple times.
  # We only need unique values
  distinct(url)


radon_family_tbl</code></pre>
<pre><code>## # A tibble: 5 x 1
##   url                                                   
##   &lt;glue&gt;                                                
## 1 https://www.radon-bikes.de/en/mountainbike/           
## 2 https://www.radon-bikes.de/en/trekking-cross/trekking/
## 3 https://www.radon-bikes.de/en/trekking-cross/cross/   
## 4 https://www.radon-bikes.de/en/e-bike/                 
## 5 https://www.radon-bikes.de/en/roadbike/</code></pre>
<p>Some categories like E-bike are further divided into subcategories. They are directly retrieved from the buttons on the site of the main category. The following function gives all relevant links to the subcategories of a main category. This function uses that main categories without subcategories don’t have a button to switch to a subcategory. For a main category without a sub category only the main category is returned again. The first provided example retrieves the subcategory links for the main category “Mountainbike”</p>
<pre class="r"><code>#function for bike dubcategories
get_bike_data_sub_category &lt;- function(url) {
  sub_node &lt;- read_html(url) %&gt;%
    
  #Check for link to subcategory
  html_nodes(css = &quot;.m-teaser-grid__linkcontainer&quot;) %&gt;%
  html_attr(&#39;href&#39;) %&gt;%
  
  # Convert vector to tibble
  enframe(name = &quot;position&quot;, value = &quot;subdirectory&quot;) %&gt;%
  mutate(
      url = glue(&quot;https://www.radon-bikes.de{subdirectory}&quot;)
    ) %&gt;%
    
    # Some categories are listed multiple times.
    # We only need unique values
  distinct(url)
  
  if (dim(sub_node)[1] != 0)
    return (sub_node)
  else
    return (tibble(url))
}



sub_node &lt;- get_bike_data_sub_category(radon_family_tbl$url[1])
sub_node</code></pre>
<pre><code>## # A tibble: 2 x 1
##   url                                                       
##   &lt;glue&gt;                                                    
## 1 https://www.radon-bikes.de/en/mountainbike/hardtail/      
## 2 https://www.radon-bikes.de/en/mountainbike/fullsuspension/</code></pre>
<p>The second example retrieves the bucategory for “Trekking”. Trelling does not have a subcategory, so the link to the main category is returned again.</p>
<pre class="r"><code>sub_node &lt;- get_bike_data_sub_category(radon_family_tbl$url[2])
sub_node</code></pre>
<pre><code>## # A tibble: 1 x 1
##   url                                                   
##   &lt;glue&gt;                                                
## 1 https://www.radon-bikes.de/en/trekking-cross/trekking/</code></pre>
<p>Attaching “bikegrid” to the url of a category leads to having an overview of all available bicycles for this category. The following function then returns a link to all individual bicycles of a (sub-)categorty. Using the “.gearhub-1” CSS also automatically filters out any non bicycle (as they don’t have gears)</p>
<pre class="r"><code>get_bike_data_url&lt;- function(url) {
  # All bikes are under bikegrid
  all_bike_html &lt;- glue(&quot;{url}bikegrid/&quot;)
  bike_url &lt;- read_html(all_bike_html) %&gt;%
    
    #Only bikes gave gears
    html_nodes(css = &quot;.gearhub-1&quot;) %&gt;%
    html_nodes(css = &quot;a&quot;) %&gt;%
    html_attr(&#39;href&#39;) %&gt;%
    # 
    # Convert vector to tibble
    enframe(name = &quot;position&quot;, value = &quot;subdirectory&quot;) %&gt;%
    mutate(
      url = glue(&quot;https://www.radon-bikes.de{subdirectory}&quot;)
    ) %&gt;%
    
    # Some categories are listed multiple times.
    # We only need unique values
    distinct(url)
  return (bike_url)
}

bike_data_url &lt;- get_bike_data_url(&quot;https://www.radon-bikes.de/en/mountainbike/hardtail/&quot;)
bike_data_url</code></pre>
<pre><code>## # A tibble: 31 x 1
##    url                                                                          
##    &lt;glue&gt;                                                                       
##  1 https://www.radon-bikes.de/en/mountainbike/hardtail/jealous/jealous-80-2021/ 
##  2 https://www.radon-bikes.de/en/mountainbike/hardtail/jealous/jealous-90-2021/ 
##  3 https://www.radon-bikes.de/en/mountainbike/hardtail/jealous/jealous-100-2021/
##  4 https://www.radon-bikes.de/en/mountainbike/hardtail/jealous/jealous-100-ea-2~
##  5 https://www.radon-bikes.de/en/mountainbike/hardtail/jealous/jealous-100-2020/
##  6 https://www.radon-bikes.de/en/mountainbike/hardtail/jealous/jealous-100-ea-2~
##  7 https://www.radon-bikes.de/en/mountainbike/hardtail/jealous-al/jealous-al-80~
##  8 https://www.radon-bikes.de/en/mountainbike/hardtail/jealous-al/jealous-al-80~
##  9 https://www.radon-bikes.de/en/mountainbike/hardtail/jealous-al/1x12/         
## 10 https://www.radon-bikes.de/en/mountainbike/hardtail/jealous-al/jealous-al-10~
## # ... with 21 more rows</code></pre>
<p>The following function can then retrieve data for an individual bicycle. The following data is retrieved: Name (retrieved from a heading inside the html), the description (from a html paragraph), availability and price. Availability and price is retrieved using a regex in part of a script of the html. The category should be privided from the calling function to complete the tibble entry.</p>
<pre class="r"><code>get_bike_data &lt;-function(url, category) {
  bike_html &lt;- read_html(url)
  bike_name &lt;- 
    bike_html %&gt;%
    
    #Only bikes gave gears
    html_node(css = &quot;.a-heading--medium&quot;) %&gt;%
    html_text()
  
  bike_descr_text &lt;- bike_html %&gt;%
    
    #Only bikes gave gears
    html_node(css = &quot;.a-paragraph--bigger&quot;) %&gt;%
    html_text()
  
  bike_script_text &lt;- bike_html %&gt;%
    
    #Only bikes gave gears
    html_nodes(css = &quot;.mod-bikedetail&quot;) %&gt;%
    
    #get first script node
    html_node(css = &quot;script&quot;) %&gt;%
    html_text()
  
  
  available &lt;- stringr::str_extract(bike_script_text, &quot;availability.*?\\{.*?\\}&quot;) %&gt;%
    str_detect(&quot;true&quot;)
  price &lt;- stringr::str_match(bike_script_text, &quot;eur.*?price.*?(\\d+)&quot;)
  price &lt;- price[2]
  
    
  return (tibble(name =  bike_name,category = category, available = available, price = as.numeric(price), descr = bike_descr_text, url = url))
}

bike_data &lt;- get_bike_data(&quot;https://www.radon-bikes.de/en/mountainbike/hardtail/jealous/jealous-80-2021/&quot;, &quot;a&quot;)
bike_data</code></pre>
<pre><code>## # A tibble: 1 x 6
##   name    category available price descr                  url                   
##   &lt;chr&gt;   &lt;chr&gt;    &lt;lgl&gt;     &lt;dbl&gt; &lt;chr&gt;                  &lt;chr&gt;                 
## 1 JEALOU~ a        TRUE       2599 Racing at an introduc~ https://www.radon-bik~</code></pre>
<p>In the last part we put all functions together in a wrapper function to retrieve all data for a category. The category for the individual bike is retrieved from the url. First the urls of the subcategories is retrieved. Then the urls of all bicycles, then the additional data from the bicycle pages. The subcategory is discarded as information and only the main category is kept. This new function can then be used to retrieve data from the complete website. This code is not executed because of the long runtime.</p>
<pre class="r"><code>get_bike_data_per_cat &lt;- function(url) {
  category &lt;- url %&gt;%
    str_replace(url_home,&quot;&quot;) %&gt;%
    str_replace(&quot;/&quot;,&quot;&quot;)
  url_per_subcat_vec &lt;- get_bike_data_sub_category(url) %&gt;% pull(url)
  url_per_bike &lt;- url_per_subcat_vec %&gt;% map(get_bike_data_url) %&gt;% bind_rows %&gt;% pull(url)

  bike_data_cat_list &lt;- url_per_bike %&gt;% map(get_bike_data, category = category)
  return (bind_rows(bike_data_cat_list))
}


#plan(&quot;multiprocess&quot;)
radon_bike_lst &lt;- radon_family_tbl %&gt;% pull(url) %&gt;% map(get_bike_data_per_cat)
radon_bike_tbl &lt;- radon_bike_lst %&gt;% bind_rows()</code></pre>
<p>The final data is displayed using saved data of a previous run:</p>
<pre class="r"><code>web_scraping_radon_data &lt;- readRDS(&quot;H:/Uni/Buiseness Data Science/Repo/WS20_Repo/web_scraping_radon_data.rds&quot;)
web_scraping_radon_data</code></pre>
<pre><code>## # A tibble: 110 x 6
##    name     category  available price descr                 url                 
##    &lt;chr&gt;    &lt;chr&gt;     &lt;lgl&gt;     &lt;dbl&gt; &lt;chr&gt;                 &lt;glue&gt;              
##  1 JEALOUS~ mountain~ TRUE       2599 &quot;Racing at an introd~ https://www.radon-b~
##  2 JEALOUS~ mountain~ TRUE       2999 &quot;This year the JEALO~ https://www.radon-b~
##  3 JEALOUS~ mountain~ TRUE       3999 &quot;\&quot;What a bullet\&quot; -~ https://www.radon-b~
##  4 JEALOUS~ mountain~ TRUE       5299 &quot;\&quot;The fastest stall~ https://www.radon-b~
##  5 JEALOUS~ mountain~ TRUE       4699 &quot;World-cup-ready or ~ https://www.radon-b~
##  6 JEALOUS~ mountain~ TRUE       4499 &quot;In the JEALOUS CF 1~ https://www.radon-b~
##  7 JEALOUS~ mountain~ TRUE        999 &quot;For the 2021 model ~ https://www.radon-b~
##  8 JEALOUS~ mountain~ TRUE       1299  &lt;NA&gt;                 https://www.radon-b~
##  9 JEALOUS~ mountain~ TRUE       1499 &quot;A classic reloaded ~ https://www.radon-b~
## 10 JEALOUS~ mountain~ TRUE       1799 &quot;Everything in our J~ https://www.radon-b~
## # ... with 100 more rows</code></pre>
</div>
</div>
<div id="data-wrangling-challenge" class="section level1">
<h1><span class="header-section-number">3</span> Data Wrangling Challenge</h1>
<div id="further-needed-libraries" class="section level2">
<h2><span class="header-section-number">3.1</span> Further needed libraries</h2>
<p>The following libraries are needed:</p>
<pre class="r"><code>library(vroom)
library(data.table)</code></pre>
</div>
<div id="loading-of-data-from-the-tables" class="section level2">
<h2><span class="header-section-number">3.2</span> Loading of data from the tables</h2>
<p>This code shows how to load the .tsv files and load the data into data.table objects. These objects are then saved in .rds files. This code is not executed due to the high execution time. Unnecessary columns for this challenge are skipped.</p>
<pre class="r"><code>library(vroom)
library(data.table)
col_types &lt;- list(
  id = col_character(),
  type = col_skip(),
  number = col_character(),
  country = col_character(),
  date = col_date(&quot;%Y-%m-%d&quot;),
  abstract = col_skip(),
  title = col_skip(),
  kind = col_skip(),
  num_claims = col_skip(),
  filename = col_skip(),
  withdrawn = col_skip()
)

patent_tbl &lt;- vroom(
  file       = &quot;./02_data_wrangling/patent.tsv&quot;, 
  delim      = &quot;\t&quot;, 
  col_types  = col_types,
  na         = c(&quot;&quot;, &quot;NA&quot;, &quot;NULL&quot;)
)

setDT(patent_tbl)
saveRDS(patent_tbl,&quot;./02_data_wrangling/patent.rds&quot;)

col_types &lt;- list(
  id = col_character(),
  type = col_integer(),
  name_first = col_skip(),
  name_last = col_skip(),
  organization = col_character()
)

assignee_tbl &lt;- vroom(
  file       = &quot;./02_data_wrangling/assignee.tsv&quot;, 
  delim      = &quot;\t&quot;, 
  col_types  = col_types,
  na         = c(&quot;&quot;, &quot;NA&quot;, &quot;NULL&quot;)
)

setDT(assignee_tbl)
saveRDS(assignee_tbl,&quot;./02_data_wrangling/assignee.rds&quot;)

col_types &lt;- list(
  id = col_character()
)

mainclass_current_tbl &lt;- vroom(
  file       = &quot;./02_data_wrangling/mainclass_current.tsv&quot;, 
  delim      = &quot;\t&quot;, 
  col_types  = col_types,
  na         = c(&quot;&quot;, &quot;NA&quot;, &quot;NULL&quot;)
)

setDT(mainclass_current_tbl)
saveRDS(mainclass_current_tbl,&quot;./02_data_wrangling/mainclass_current.rds&quot;)

col_types &lt;- list(
  patent_id = col_character(),
  assignee_id = col_character(),
  location_id = col_character()
)

patent_assignee_tbl &lt;- vroom(
  file       = &quot;./02_data_wrangling/patent_assignee.tsv&quot;, 
  delim      = &quot;\t&quot;, 
  col_types  = col_types,
  na         = c(&quot;&quot;, &quot;NA&quot;, &quot;NULL&quot;)
)

setDT(patent_assignee_tbl)
saveRDS(patent_assignee_tbl,&quot;./02_data_wrangling/patent_assignee.rds&quot;)


col_types &lt;- list(
  uuid = col_character(),
  patent_id = col_character(),
  mainclass_id = col_character(),
  subclass_id = col_character(),
  sequence = col_skip()
)

uspc_tbl &lt;- vroom(
  file       = &quot;./02_data_wrangling/uspc.tsv&quot;, 
  delim      = &quot;\t&quot;, 
  col_types  = col_types,
  na         = c(&quot;&quot;, &quot;NA&quot;, &quot;NULL&quot;)
)

setDT(uspc_tbl)
saveRDS(uspc_tbl,&quot;./02_data_wrangling/uspc.rds&quot;)</code></pre>
<div id="loading-the-data-from-.rds-files" class="section level3">
<h3><span class="header-section-number">3.2.1</span> Loading the data from .rds files</h3>
<p>To use the data it is now loaded from the .rds files and keys are set.</p>
<pre class="r"><code>patent_tbl &lt;- readRDS(&quot;./02_data_wrangling/patent.rds&quot;)
assignee_tbl &lt;- readRDS(&quot;./02_data_wrangling/assignee.rds&quot;)
mainclass_current_tbl &lt;- readRDS(&quot;./02_data_wrangling/mainclass_current.rds&quot;)
patent_assignee_tbl &lt;- readRDS(&quot;./02_data_wrangling/patent_assignee.rds&quot;)
uspc_tbl &lt;- readRDS(&quot;./02_data_wrangling/uspc.rds&quot;)

setkey(patent_tbl, id)
setkey(assignee_tbl, id)
setkey(mainclass_current_tbl, id)
setkey(patent_assignee_tbl, patent_id)
setkey(uspc_tbl, uuid)</code></pre>
</div>
</div>
<div id="top-us-companies" class="section level2">
<h2><span class="header-section-number">3.3</span> Top US Companies</h2>
<p>To get the top US companies with the most patents, we first create a data table for all patents that are assigned to a company. For this specific challenge we need only US companies. For the further challenges we also need to consider companies worldwide. To achieve this we join the table “assignee” and “patent_assignee”. To filter for US companies we can filter for type 2. Worldwide companies are either US (type = 2) or foreign (type = 3).</p>
<pre class="r"><code>company_assigned_patent_tbl &lt;- assignee_tbl[patent_assignee_tbl, on = c(id = &quot;assignee_id&quot;)][type == 2]
company_assigned_patent_world &lt;- assignee_tbl[patent_assignee_tbl, on = c(id = &quot;assignee_id&quot;)][type == 2 | type == 3]</code></pre>
<p>To get the top 10 companies we can now do the following:</p>
<ol style="list-style-type: decimal">
<li>Group By organization</li>
<li>Count the number of patents</li>
<li>Order by number of patents</li>
<li>Get first 10 entries</li>
</ol>
<pre class="r"><code>top_company_tbl &lt;- company_assigned_patent_tbl[, .(numOfPatents = .N), by = organization][order(-numOfPatents)][1:10]

top_company_tbl</code></pre>
<pre><code>##                                    organization numOfPatents
##  1: International Business Machines Corporation       139091
##  2:                    General Electric Company        47121
##  3:                           Intel Corporation        42156
##  4:   Hewlett-Packard Development Company, L.P.        35572
##  5:                       Microsoft Corporation        30085
##  6:                     Micron Technology, Inc.        28000
##  7:                       QUALCOMM Incorporated        24702
##  8:              Texas Instruments Incorporated        24181
##  9:                           Xerox Corporation        23173
## 10:                                  Apple Inc.        21820</code></pre>
</div>
<div id="top-us-companies-2019" class="section level2">
<h2><span class="header-section-number">3.4</span> Top US Companies 2019</h2>
<p>To only consider data from 2019, we need to evaluate the table “patent”. Here a date for the assignment is given. We can join our previously created table with the US companies with the “patent” table and then filter by the year 2019.</p>
<pre class="r"><code>top_company_tbl_2019 &lt;- patent_tbl[company_assigned_patent_tbl, on = c(number = &quot;patent_id&quot;)][lubridate::year(date) == 2019][
                                      , .(numOfPatents = .N), by = organization][order(-numOfPatents)][1:10]
top_company_tbl_2019</code></pre>
<pre><code>##                                    organization numOfPatents
##  1: International Business Machines Corporation         9265
##  2:                           Intel Corporation         3526
##  3:         Microsoft Technology Licensing, LLC         3106
##  4:                                  Apple Inc.         2817
##  5:               Ford Global Technologies, LLC         2624
##  6:                   Amazon Technologies, Inc.         2533
##  7:                       QUALCOMM Incorporated         2359
##  8:                                 Google Inc.         2290
##  9:                    General Electric Company         1860
## 10:   Hewlett-Packard Development Company, L.P.         1589</code></pre>
</div>
<div id="top-5-uspto-classes" class="section level2">
<h2><span class="header-section-number">3.5</span> Top 5 USPTO classes</h2>
<p>Approach:</p>
<ol style="list-style-type: decimal">
<li>Get top 10 companies worldwide</li>
<li>Filter the table with companies and patents, to only get patents from these top 10</li>
<li>Join with table “uspc”</li>
<li>Group By mainclass_id</li>
<li>Count patents per mainclass</li>
<li>Select top 5</li>
<li>Join table “mainclass” to get title of mainclass</li>
</ol>
<p>Top 10 companies worldwide:</p>
<pre class="r"><code>top_company_world &lt;- company_assigned_patent_world[, .(numOfPatents = .N), by = organization][order(-numOfPatents)][1:10]
top_company_world</code></pre>
<pre><code>##                                    organization numOfPatents
##  1: International Business Machines Corporation       139091
##  2:               Samsung Electronics Co., Ltd.        93561
##  3:                      Canon Kabushiki Kaisha        75909
##  4:                            Sony Corporation        54342
##  5:                    Kabushiki Kaisha Toshiba        49442
##  6:                    General Electric Company        47121
##  7:                               Hitachi, Ltd.        45374
##  8:                           Intel Corporation        42156
##  9:                             Fujitsu Limited        37196
## 10:   Hewlett-Packard Development Company, L.P.        35572</code></pre>
<p>Top 5 categories:</p>
<pre class="r"><code>top_company_patents &lt;- company_assigned_patent_world[organization %in% top_company_world[,organization]]

top_uspc_id_tbl &lt;- top_company_patents[uspc_tbl, on = c(patent_id = &quot;patent_id&quot;), nomatch=0][, 
                                      .(patentsPerCat = .N), by = mainclass_id][order(-patentsPerCat)][1:5]
top_uspc_tbl &lt;- mainclass_current_tbl[top_uspc_id_tbl, on = c(id=&quot;mainclass_id&quot;)]

top_uspc_tbl</code></pre>
<pre><code>##     id                                                              title
## 1: 257 ACTIVE SOLID-STATE DEVICES (E.G., TRANSISTORS, SOLID-STATE DIODES)
## 2: 438                        SEMICONDUCTOR DEVICE MANUFACTURING: PROCESS
## 3: 365                           STATIC INFORMATION STORAGE AND RETRIEVAL
## 4: 370                                           MULTIPLEX COMMUNICATIONS
## 5: 358                       FACSIMILE AND STATIC PRESENTATION PROCESSING
##    patentsPerCat
## 1:         90981
## 2:         52071
## 3:         40283
## 4:         36369
## 5:         36227</code></pre>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
